name: PR Checks

on:
    push:
        branches:
            - main
            - develop
            - release/*
    pull_request:
        branches:
            - main
            - develop
            - release/*
    workflow_dispatch:

defaults:
    run:
        shell: bash

permissions:
    contents: read
    packages: write

env:
    LC_ALL: C.UTF-8
    GRADLE_CACHE_USERNAME: ${{ secrets.GRADLE_CACHE_USERNAME }}
    GRADLE_CACHE_PASSWORD: ${{ secrets.GRADLE_CACHE_PASSWORD }}

jobs:
    test:
        strategy:
            matrix:
                instances: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
        name: Run Local Node
        runs-on: ubuntu-latest
        steps:
            - name: Checkout Code
              uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4.1.7
              with:
                  fetch-depth: 0 # Shallow clones should be disabled for a better relevancy of analysis

            - name: Setup NodeJS
              uses: actions/setup-node@1e60f620b9541d16bece96c5465dc8ee9832be0b # v4.0.3
              with:
                  node-version: 18

            - name: Get Local Node
              uses: actions/checkout@v4
              with:
                  repository: hashgraph/hedera-local-node
                  path: local-node

            - name: Run Local Node
              run: |
                  cd local-node
                  npm ci
                  npm run start -- -d --network local --verbose=trace
